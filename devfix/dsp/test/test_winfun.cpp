//
// Created by core on 7/15/20.
//


#if CPPLIBS_ENABLE_DSP_TESTS == 1

#include <catch2/catch.hpp>
#include "../../../testutil.h"
#include "../window.h"
#include "../winfun.h"

using namespace devfix::base;
using namespace devfix::dsp;

template<typename FloatT>
std::vector<FloatT> get_win_vals(const window<FloatT>& win)
{
	std::vector<FloatT> vec(win.size(), FloatT(1));
	win.apply(vec);
	return vec;
}

TEST_CASE("devfix/dsp/winfun/hanning/small")
{
	auto test = [] < typename FloatT > (FloatT
	_, long double
	margin)
	{
		const std::vector<FloatT> expected = {
			0, 0.188255099070633, 0.611260466978157, 0.950484433951210, 0.950484433951210, 0.611260466978157, 0.188255099070633, 0
		};
		window<FloatT> win(winfun::hanning, expected.size(), false);
		const auto vals = get_win_vals(win);
		testutil::check_equals(vals, expected, margin);
	};
	test((float) (1), testutil::MARGIN_COARSE);
	test((double) (1), testutil::MARGIN_FINE);
	test((long double) (1), testutil::MARGIN_FINE);
}

TEST_CASE("devfix/dsp/winfun/hanning/large")
{
	auto test = [] < typename FloatT > (FloatT
	_, long double
	margin)
	{
		const std::vector<FloatT> expected = {
			0, 0.000151774011064, 0.000607003902855, 0.001365413307106, 0.002426541796468, 0.003789745164032, 0.005454195814427,
			0.007418883266247, 0.009682614765511, 0.012244016009782, 0.015101531982495, 0.018253427897008, 0.021697790249780,
			0.025432527982049, 0.029455373749314, 0.033763885297822, 0.038355446947255, 0.043227271178700, 0.048376400326936,
			0.053799708376026, 0.059493902857108, 0.065455526847236, 0.071680961068069, 0.078166426083117, 0.084907984592225,
			0.091901543821889, 0.099142858009967, 0.106627530983258, 0.114351018826410, 0.122308632640503, 0.130495541389670,
			0.138906774833995, 0.147537226546926, 0.156381657015369, 0.165434696820571, 0.174690849897879, 0.184144496873374,
			0.193789898475375, 0.203621199018723, 0.213632429959747, 0.223817513519747, 0.234170266374782, 0.244684403409547,
			0.255353541533038, 0.266171203553707, 0.277130822111731, 0.288225743666038, 0.299449232533641, 0.310794474978845,
			0.322254583349841, 0.333822600260170, 0.345491502812526, 0.357254206862329, 0.369103571318480, 0.381032402478691,
			0.393033458396751, 0.405099453279087, 0.417223061907935, 0.429396924088454, 0.441613649117072, 0.453865820268349,
			0.466145999297646, 0.478446730956852, 0.490760547520435, 0.503079973319069, 0.515397529278085, 0.527705737457985,
			0.539997125594271, 0.552264231633827, 0.564499608265101, 0.576695827439343, 0.588845484880134, 0.600941204578505,
			0.612975643270874, 0.624941494897115, 0.636831495036041, 0.648638425315601, 0.660355117795127, 0.671974459316964,
			0.683489395824836, 0.694892936646340, 0.706178158736952, 0.717338210882982, 0.728366317860920, 0.739255784550643,
			0.750000000000000, 0.760592441438293, 0.771026678236225, 0.781296375809912, 0.791395299466580, 0.801317318189628,
			0.811056408360737, 0.820606657416789, 0.829962267439361, 0.839117558674617, 0.848066972981463, 0.856805077205876,
			0.865326566479347, 0.873626267439445, 0.881699141370551, 0.889540287262835, 0.897144944787643, 0.904508497187474,
			0.911626474078794, 0.918494554165989, 0.925108567864807, 0.931464499833695, 0.937558491411496, 0.943386842960031,
			0.948946016110129, 0.954232635909762, 0.959243492872962, 0.963975544928287, 0.968425919265655, 0.972591914080410,
			0.976471000213578, 0.980060822687314, 0.983359202134594, 0.986364136122302, 0.989073800366903, 0.991486549841951,
			0.993600919776785, 0.995415626545780, 0.996929568447637, 0.998141826374215, 0.999051664368522, 0.999658530071512,
			0.999962055057415, 0.999962055057415, 0.999658530071512, 0.999051664368522, 0.998141826374215, 0.996929568447637,
			0.995415626545780, 0.993600919776785, 0.991486549841951, 0.989073800366903, 0.986364136122302, 0.983359202134594,
			0.980060822687314, 0.976471000213578, 0.972591914080410, 0.968425919265655, 0.963975544928287, 0.959243492872962,
			0.954232635909762, 0.948946016110129, 0.943386842960031, 0.937558491411496, 0.931464499833695, 0.925108567864807,
			0.918494554165989, 0.911626474078794, 0.904508497187474, 0.897144944787643, 0.889540287262835, 0.881699141370551,
			0.873626267439445, 0.865326566479347, 0.856805077205876, 0.848066972981463, 0.839117558674617, 0.829962267439361,
			0.820606657416789, 0.811056408360737, 0.801317318189628, 0.791395299466580, 0.781296375809912, 0.771026678236225,
			0.760592441438293, 0.750000000000000, 0.739255784550643, 0.728366317860920, 0.717338210882982, 0.706178158736952,
			0.694892936646340, 0.683489395824836, 0.671974459316964, 0.660355117795127, 0.648638425315601, 0.636831495036041,
			0.624941494897115, 0.612975643270874, 0.600941204578505, 0.588845484880134, 0.576695827439343, 0.564499608265101,
			0.552264231633827, 0.539997125594271, 0.527705737457985, 0.515397529278085, 0.503079973319069, 0.490760547520435,
			0.478446730956852, 0.466145999297646, 0.453865820268349, 0.441613649117072, 0.429396924088454, 0.417223061907935,
			0.405099453279087, 0.393033458396751, 0.381032402478691, 0.369103571318480, 0.357254206862329, 0.345491502812526,
			0.333822600260170, 0.322254583349841, 0.310794474978845, 0.299449232533641, 0.288225743666038, 0.277130822111731,
			0.266171203553707, 0.255353541533038, 0.244684403409547, 0.234170266374782, 0.223817513519747, 0.213632429959747,
			0.203621199018723, 0.193789898475375, 0.184144496873374, 0.174690849897879, 0.165434696820571, 0.156381657015369,
			0.147537226546926, 0.138906774833995, 0.130495541389670, 0.122308632640503, 0.114351018826410, 0.106627530983258,
			0.099142858009967, 0.091901543821889, 0.084907984592225, 0.078166426083117, 0.071680961068069, 0.065455526847236,
			0.059493902857108, 0.053799708376026, 0.048376400326936, 0.043227271178700, 0.038355446947255, 0.033763885297822,
			0.029455373749314, 0.025432527982049, 0.021697790249780, 0.018253427897008, 0.015101531982495, 0.012244016009782,
			0.009682614765511, 0.007418883266247, 0.005454195814427, 0.003789745164032, 0.002426541796468, 0.001365413307106,
			0.000607003902855, 0.000151774011064, 0
		};
		window<FloatT> win(winfun::hanning, expected.size(), false);
		const auto vals = get_win_vals(win);
		testutil::check_equals(vals, expected, margin);
	};
	test((float) (1), testutil::MARGIN_COARSE);
	test((double) (1), testutil::MARGIN_FINE);
	test((long double) (1), testutil::MARGIN_FINE);
}

TEST_CASE("devfix/dsp/winfun/flattop_matlab/small")
{
	auto test = [] < typename FloatT > (FloatT
	_, long double
	margin)
	{
		const std::vector<FloatT> expected = {
			-0.000421051000000, -0.036840781154923, 0.010703716716153, 0.780873914938770, 0.780873914938770, 0.010703716716153,
			-0.036840781154923, -0.000421051000000
		};
		window<FloatT> win(winfun::flattop_matlab, expected.size(), false);
		const auto vals = get_win_vals(win);
		testutil::check_equals(vals, expected, margin);
	};
	test((float) (1), testutil::MARGIN_COARSE);
	test((double) (1), testutil::MARGIN_FINE);
	test((long double) (1), testutil::MARGIN_FINE);
}

TEST_CASE("devfix/dsp/winfun/flattop_matlab/large")
{
	auto test = [] < typename FloatT > (FloatT
	_, long double
	margin)
	{
		const std::vector<FloatT> expected = {
			-0.000421051000000, -0.000436659490782, -0.000483663782943, -0.000562598641738, -0.000674349696856, -0.000820144979401,
			-0.001001543085212, -0.001220417976986, -0.001478940442443, -0.001779556231563, -0.002124960902685, -0.002518071415384,
			-0.002961994517409, -0.003459991983935, -0.004015442779792, -0.004631802229465, -0.005312558295298, -0.006061185081706,
			-0.006881093702061, -0.007775580665323, -0.008747773961265, -0.009800577046162, -0.010936610954949, -0.012158154790793,
			-0.013467084868694, -0.014864812815692, -0.016352222956415, -0.017929609338566, -0.019596612778384, -0.021352158330598,
			-0.023194393610757, -0.025120628419562, -0.027127276138673, -0.029209797385042, -0.031362646425778, -0.033579220867505,
			-0.035851815142883, -0.038171578322033, -0.040528476777797, -0.042911262230822, -0.045307445693099, -0.047703277816724,
			-0.050083736137964, -0.052432519685291, -0.054732051393607, -0.056963488735580, -0.059106742944756, -0.061140507163974,
			-0.063042293806821, -0.064788481369425, -0.066354370875188, -0.067714252076212, -0.068841479472678, -0.069708558145464,
			-0.070287239328412, -0.070548625575245, -0.070463285302718, -0.070001376416658, -0.069132778651722, -0.067827234179550,
			-0.066054495964062, -0.063784483267707, -0.060987443639008, -0.057634120640562, -0.053695926508227, -0.049145118867417,
			-0.043954980571641, -0.038100001672458, -0.031556062479395, -0.024300616623639, -0.016312873001061, -0.007573975438819,
			0.001932821094179, 0.012221978928755, 0.023305511992752, 0.035192827167530, 0.047890573898064, 0.061402503233118,
			0.075729337445292, 0.090868651345027, 0.106814766358197, 0.123558658383638, 0.141087880385248, 0.159386500603226,
			0.178435057191136, 0.198210530000000, 0.218686330138212, 0.239832307837127, 0.261614779047383, 0.283996571081039,
			0.306937087500129, 0.330392392334040, 0.354315313587027, 0.378655565873987, 0.403359891898242, 0.428372222360416,
			0.453633853763390, 0.479083643455783, 0.504658221136277, 0.530292215924370, 0.555918497990583, 0.581468433631835,
			0.606872152576212, 0.632058826206813, 0.656956955307250, 0.681494665852601, 0.705600011299798, 0.729201279771092,
			0.752227304474060, 0.774607775661899, 0.796273552409043, 0.817156972459602, 0.837192158400087, 0.856315318413451,
			0.874465039888664, 0.891582574188920, 0.907612110921859, 0.922501040106862, 0.936200200697049, 0.948664113986879,
			0.959851200519604, 0.969723979201831, 0.978249247434398, 0.985398241179102, 0.991146773998595, 0.995475354231399,
			0.998369279594438, 0.999818708640924, 0.999818708640924, 0.998369279594438, 0.995475354231399, 0.991146773998595,
			0.985398241179102, 0.978249247434398, 0.969723979201831, 0.959851200519604, 0.948664113986879, 0.936200200697049,
			0.922501040106862, 0.907612110921859, 0.891582574188920, 0.874465039888664, 0.856315318413451, 0.837192158400087,
			0.817156972459602, 0.796273552409043, 0.774607775661899, 0.752227304474060, 0.729201279771092, 0.705600011299798,
			0.681494665852601, 0.656956955307250, 0.632058826206813, 0.606872152576212, 0.581468433631835, 0.555918497990583,
			0.530292215924370, 0.504658221136277, 0.479083643455783, 0.453633853763390, 0.428372222360416, 0.403359891898242,
			0.378655565873987, 0.354315313587027, 0.330392392334040, 0.306937087500129, 0.283996571081039, 0.261614779047383,
			0.239832307837127, 0.218686330138212, 0.198210530000000, 0.178435057191136, 0.159386500603226, 0.141087880385248,
			0.123558658383638, 0.106814766358197, 0.090868651345027, 0.075729337445292, 0.061402503233118, 0.047890573898064,
			0.035192827167530, 0.023305511992752, 0.012221978928755, 0.001932821094179, -0.007573975438819, -0.016312873001061,
			-0.024300616623639, -0.031556062479395, -0.038100001672458, -0.043954980571641, -0.049145118867417, -0.053695926508227,
			-0.057634120640562, -0.060987443639008, -0.063784483267707, -0.066054495964062, -0.067827234179550, -0.069132778651722,
			-0.070001376416658, -0.070463285302718, -0.070548625575245, -0.070287239328412, -0.069708558145464, -0.068841479472678,
			-0.067714252076212, -0.066354370875188, -0.064788481369425, -0.063042293806821, -0.061140507163974, -0.059106742944756,
			-0.056963488735580, -0.054732051393607, -0.052432519685291, -0.050083736137964, -0.047703277816724, -0.045307445693099,
			-0.042911262230822, -0.040528476777797, -0.038171578322033, -0.035851815142883, -0.033579220867505, -0.031362646425778,
			-0.029209797385042, -0.027127276138673, -0.025120628419562, -0.023194393610757, -0.021352158330598, -0.019596612778384,
			-0.017929609338566, -0.016352222956415, -0.014864812815692, -0.013467084868694, -0.012158154790793, -0.010936610954949,
			-0.009800577046162, -0.008747773961265, -0.007775580665323, -0.006881093702061, -0.006061185081706, -0.005312558295298,
			-0.004631802229465, -0.004015442779792, -0.003459991983935, -0.002961994517409, -0.002518071415384, -0.002124960902685,
			-0.001779556231563, -0.001478940442443, -0.001220417976986, -0.001001543085212, -0.000820144979401, -0.000674349696856,
			-0.000562598641738, -0.000483663782943, -0.000436659490782, -0.000421051000000
		};
		window<FloatT> win(winfun::flattop_matlab, expected.size(), false);
		auto vals = get_win_vals(win);
		testutil::check_equals(vals, expected, margin);
	};
	test((float) (1), testutil::MARGIN_COARSE);
	test((double) (1), testutil::MARGIN_FINE);
	test((long double) (1), testutil::MARGIN_FINE);
}

TEST_CASE("devfix/dsp/winfun/hamming/small")
{
	auto test = [] < typename FloatT > (FloatT
	_, long double
	margin)
	{
		const std::vector<FloatT> expected = {
			0.080000000000000, 0.253194691144983, 0.642359629619905, 0.954445679235113, 0.954445679235113, 0.642359629619905,
			0.253194691144983, 0.080000000000000
		};
		window<FloatT> win(winfun::hamming, expected.size(), false);
		const auto vals = get_win_vals(win);
		testutil::check_equals(vals, expected, margin);
	};
	test((float) (1), testutil::MARGIN_COARSE);
	test((double) (1), testutil::MARGIN_FINE);
	test((long double) (1), testutil::MARGIN_FINE);
}

TEST_CASE("devfix/dsp/winfun/hamming/large")
{
	auto test = [] < typename FloatT > (FloatT
	_, long double
	margin)
	{
		const std::vector<FloatT> expected = {
			0.080000000000000, 0.080139632090179, 0.080558443590627, 0.081256180242538, 0.082232418452750, 0.083486565550910,
			0.085017860149273, 0.086825372604947, 0.088908005584270, 0.091264494728999, 0.093893409423896, 0.096793153665248,
			0.099961967029797, 0.103397925743485, 0.107098943849369, 0.111062774473996, 0.115287011191475, 0.119769089484404,
			0.124506288300781, 0.129495731705944, 0.134734390628539, 0.140219084699457, 0.145946484182623, 0.151913111996467,
			0.158115345824847, 0.164549420316138, 0.171211429369169, 0.178097328504598, 0.185202937320297, 0.192523942029263,
			0.200055898078497, 0.207794232847276, 0.215734248423172, 0.223871124454139, 0.232199921074925, 0.240715581906049,
			0.249412937123505, 0.258286706597345, 0.267331503097225, 0.276541835562968, 0.285912112438167, 0.295436645064799,
			0.305109651136783, 0.314925258210395, 0.324877507269410, 0.334960356342792, 0.345167684172755, 0.355493293930949,
			0.365930916980537, 0.376474216681854, 0.387116792239357, 0.397852182587524, 0.408673870313343, 0.419575285613002,
			0.430549810280395, 0.441590781725011, 0.452691497016760, 0.463845216955300, 0.475045170161378, 0.486284557187706,
			0.497556554646881, 0.508854319353835, 0.520170992480304, 0.531499703718800, 0.542833575453544, 0.554165726935838,
			0.565489278461346, 0.576797355546729, 0.588083093103121, 0.599339639603893, 0.610560161244195, 0.621737846089724,
			0.632865908212225, 0.643937591809204, 0.654946175305346, 0.665884975433158, 0.676747351290353, 0.687526708371517,
			0.698216502571607, 0.708810244158849, 0.719301501714632, 0.729683906037996, 0.739951154012344, 0.750097012432047,
			0.760115321786592, 0.770000000000000, 0.779745046123229, 0.789344543977327, 0.798792665745119, 0.808083675509254,
			0.817211932734458, 0.826171895691878, 0.834958124823446, 0.843565286044212, 0.851988153980648, 0.860221615142946,
			0.868260671029406, 0.876100441160999, 0.883736166044290, 0.891163210060907, 0.898377064281809, 0.905373349204632,
			0.912147817412476, 0.918696356152490, 0.925014989832710, 0.931099882435622, 0.936947339846999, 0.942553812098577,
			0.947915895523229, 0.953030334821319, 0.957894025036981, 0.962504013443125, 0.966857501334024, 0.970951845724403,
			0.974784560953977, 0.978353320196492, 0.981655956872329, 0.984690465963826, 0.987455005232518, 0.989947896337551,
			0.992167625854595, 0.994112846194642, 0.995782376422118, 0.997175202971826, 0.998290480264278, 0.999127531219040,
			0.999685847665791, 0.999965090652822, 0.999965090652822, 0.999685847665791, 0.999127531219040, 0.998290480264278,
			0.997175202971826, 0.995782376422118, 0.994112846194642, 0.992167625854595, 0.989947896337551, 0.987455005232518,
			0.984690465963826, 0.981655956872329, 0.978353320196492, 0.974784560953977, 0.970951845724403, 0.966857501334024,
			0.962504013443125, 0.957894025036981, 0.953030334821319, 0.947915895523229, 0.942553812098577, 0.936947339846999,
			0.931099882435622, 0.925014989832710, 0.918696356152490, 0.912147817412476, 0.905373349204632, 0.898377064281809,
			0.891163210060907, 0.883736166044290, 0.876100441160999, 0.868260671029406, 0.860221615142946, 0.851988153980648,
			0.843565286044212, 0.834958124823446, 0.826171895691878, 0.817211932734458, 0.808083675509254, 0.798792665745119,
			0.789344543977327, 0.779745046123229, 0.770000000000000, 0.760115321786592, 0.750097012432047, 0.739951154012344,
			0.729683906037996, 0.719301501714632, 0.708810244158849, 0.698216502571607, 0.687526708371517, 0.676747351290353,
			0.665884975433158, 0.654946175305346, 0.643937591809204, 0.632865908212225, 0.621737846089724, 0.610560161244195,
			0.599339639603893, 0.588083093103121, 0.576797355546729, 0.565489278461346, 0.554165726935838, 0.542833575453544,
			0.531499703718800, 0.520170992480304, 0.508854319353835, 0.497556554646881, 0.486284557187706, 0.475045170161378,
			0.463845216955300, 0.452691497016760, 0.441590781725011, 0.430549810280395, 0.419575285613002, 0.408673870313343,
			0.397852182587524, 0.387116792239357, 0.376474216681854, 0.365930916980537, 0.355493293930949, 0.345167684172755,
			0.334960356342792, 0.324877507269410, 0.314925258210395, 0.305109651136783, 0.295436645064799, 0.285912112438167,
			0.276541835562968, 0.267331503097225, 0.258286706597345, 0.249412937123505, 0.240715581906049, 0.232199921074925,
			0.223871124454139, 0.215734248423172, 0.207794232847276, 0.200055898078497, 0.192523942029263, 0.185202937320297,
			0.178097328504598, 0.171211429369169, 0.164549420316138, 0.158115345824847, 0.151913111996467, 0.145946484182623,
			0.140219084699457, 0.134734390628539, 0.129495731705944, 0.124506288300781, 0.119769089484404, 0.115287011191475,
			0.111062774473996, 0.107098943849369, 0.103397925743485, 0.099961967029797, 0.096793153665248, 0.093893409423896,
			0.091264494728999, 0.088908005584270, 0.086825372604947, 0.085017860149273, 0.083486565550910, 0.082232418452750,
			0.081256180242538, 0.080558443590627, 0.080139632090179, 0.080000000000000
		};
		window<FloatT> win(winfun::hamming, expected.size(), false);
		const auto vals = get_win_vals(win);
		testutil::check_equals(vals, expected, margin);
	};
	test((float) (1), testutil::MARGIN_COARSE);
	test((double) (1), testutil::MARGIN_FINE);
	test((long double) (1), testutil::MARGIN_FINE);
}

TEST_CASE("devfix/dsp/winfun/flattop_hft248d/small")
{
	auto test = [] < typename FloatT > (FloatT
	_, long double
	margin)
	{
		const std::vector<FloatT> expected = { 3.978352935973817e-08, -0.002240566303953528, -0.3593963980674744, 3.833164215087891,
											   3.833165168762207, -0.3593966066837311, -0.002241416368633509, 3.978352935973817e-08, };
		window<FloatT> win(winfun::flattop_hft248d, expected.size(), false);
		const auto vals = get_win_vals(win);
		testutil::check_equals(vals, expected, margin);
	};
	test((float) (1), testutil::MARGIN_COARSE);
	test((double) (1), testutil::MARGIN_FINE);
	test((long double) (1), testutil::MARGIN_FINE);
}

TEST_CASE("devfix/dsp/winfun/flattop_hft248d/large")
{
	auto test = [] < typename FloatT > (FloatT
	_, long double
	margin)
	{
		const std::vector<FloatT> expected =
			{ 3.312666447372764e-17, -7.536753207464844e-11, -3.952556977667863e-10, -1.280320018462622e-09, -3.403028132435335e-09,
			  -8.019862032765696e-09, -1.734841879202076e-08, -3.514547329775225e-08, -6.7563834126167e-08, -1.243918415941715e-07,
			  -2.208104835151555e-07, -3.798401170594137e-07, -6.356923571432439e-07, -1.038293324451036e-06, -1.659302463629546e-06,
			  -2.600016544648514e-06, -4.00162096704372e-06, -6.058329367492846e-06, -9.034036561692827e-06, -1.328319725564486e-05,
			  -1.927673130296116e-05, -2.763384242195925e-05, -3.916071730307492e-05, -5.489714120890562e-05, -7.617211897964453e-05,
			  -0.0001046696204662592, -0.0001425055697244279, -0.0001923171601138793, -0.0002573654944872922, -0.0003416524123416363,
			  -0.0004500521654935558, -0.0005884583320471261, -0.0007639460071892306, -0.0009849488717690797, -0.001261450209913102,
			  -0.001605186321414642, -0.002029860051727931, -0.002551361343372696, -0.003187990802083902, -0.003960681277306027,
			  -0.004893211392261344, -0.006012403840655048, -0.00734830011695788, -0.008934302191628306, -0.01080727051315634,
			  -0.01300756665154172, -0.01557902793334535, -0.01856886060108122, -0.02202743740695867, -0.0260079851723021,
			  -0.03056614776004363, -0.03575941016855119, -0.04164637010904745, -0.04828584452069197, -0.05573580004619044,
			  -0.06405209856873378, -0.07328705152076352, -0.08348777982835914, -0.09469438005077389, -0.1069379014970276,
			  -0.1202381438190877, -0.1346012897452876, -0.1500173931618219, -0.1664577485900051, -0.1838721741399214, -0.2021862461274455,
			  -0.2212985295856583, -0.2410778547336084, -0.2613606949236219, -0.2819487065027393, -0.3026064952191911, -0.3230596771047812,
			  -0.3429933039960051, -0.3620507248562458, -0.3798329536777243, -0.3958986128426236, -0.4097645172995161, -0.4209069596841573,
			  -0.4287637495363076, -0.4327370510275253, -0.4321970531506027, -0.4264864942048064, -0.4149260487627761, -0.3968205702910676,
			  -0.371466166428392, -0.3381580668585, -0.296199226043823, -0.2449095851427311, -0.1836358995797475, -0.1117620213599546,
			  -0.02871950871806289, 0.06600157952172285, 0.1728418610195993, 0.292161946004659, 0.4242320689177188, 0.5692222183297876,
			  0.7271929509240799, 0.8980870750555438, 1.081722385598751, 1.277785624346033, 1.485827829081114, 1.705261219666363,
			  1.93535775116355, 2.175249442361122, 2.423930563390053, 2.680261738738552, 2.942975992360773, 3.21068673021945,
			  3.481897623068297, 3.755014319174235, 4.028357883643457, 4.300179828710685, 4.568678568445065, 4.832017102477009,
			  5.088341707191068, 5.335801389953597, 5.572567842889359, 5.7968556179582, 6.006942235001444, 6.201187929326401,
			  6.378054745474801, 6.536124689170246, 6.674116660043459, 6.790901903463734, 6.885517740422127, 6.957179359572351,
			  7.005289484795165, 7.029445764477716, 7.029445764477716, 7.005289484795165, 6.957179359572352, 6.885517740422128,
			  6.790901903463734, 6.67411666004346, 6.536124689170247, 6.378054745474804, 6.201187929326403, 6.006942235001445,
			  5.796855617958202, 5.572567842889362, 5.335801389953598, 5.088341707191073, 4.832017102477012, 4.568678568445065,
			  4.300179828710688, 4.02835788364346, 3.755014319174238, 3.4818976230683, 3.210686730219452, 2.942975992360776,
			  2.680261738738554, 2.423930563390055, 2.175249442361127, 1.935357751163552, 1.705261219666365, 1.485827829081116,
			  1.277785624346034, 1.081722385598754, 0.8980870750555456, 0.7271929509240806, 0.5692222183297894, 0.4242320689177201,
			  0.2921619460046612, 0.1728418610196025, 0.06600157952172503, -0.02871950871806048, -0.1117620213599555, -0.1836358995797472,
			  -0.2449095851427305, -0.2961992260438228, -0.3381580668585003, -0.3714661664283916, -0.3968205702910677, -0.4149260487627749,
			  -0.4264864942048059, -0.4321970531506023, -0.4327370510275245, -0.4287637495363085, -0.4209069596841577, -0.4097645172995162,
			  -0.3958986128426244, -0.3798329536777242, -0.362050724856245, -0.3429933039960057, -0.3230596771047811, -0.3026064952191895,
			  -0.2819487065027395, -0.2613606949236229, -0.2410778547336098, -0.2212985295856582, -0.2021862461274457, -0.1838721741399225,
			  -0.1664577485900047, -0.1500173931618216, -0.1346012897452881, -0.120238143819087, -0.1069379014970255, -0.09469438005077369,
			  -0.08348777982835992, -0.07328705152076506, -0.0640520985687352, -0.05573580004619049, -0.04828584452069286,
			  -0.04164637010904794, -0.03575941016855031, -0.03056614776004392, -0.02600798517230112, -0.02202743740695764,
			  -0.0185688606010827, -0.01557902793334564, -0.01300756665154209, -0.01080727051315672, -0.008934302191628317,
			  -0.007348300116958014, -0.006012403840654664, -0.004893211392261278, -0.003960681277306128, -0.003187990802083608,
			  -0.002551361343373447, -0.002029860051728652, -0.001605186321412982, -0.001261450209911799, -0.0009849488717683029,
			  -0.0007639460071892322, -0.0005884583320481014, -0.000450052165495557, -0.0003416524123402636, -0.0002573654944874116,
			  -0.0001923171601148689, -0.000142505569726363, -0.0001046696204660883, -7.617211897610896e-05, -5.489714120663626e-05,
			  -3.91607173023665e-05, -2.763384242195901e-05, -1.927673130383001e-05, -1.328319725817688e-05, -9.034036560743839e-06,
			  -6.058329367346034e-06, -4.001620968624496e-06, -2.600016547112912e-06, -1.659302462806453e-06, -1.038293324925819e-06,
			  -6.356923551048339e-07, -3.798401167056884e-07, -2.208104834847084e-07, -1.243918419752259e-07, -6.756383558424329e-08,
			  -3.514547298385372e-08, -1.734841880881906e-08, -8.019862747819099e-09, -3.403027547260952e-09, -1.28032000196343e-09,
			  -3.952557869800693e-10, -7.536733772166016e-11, 3.312666447372764e-17,
			};
		window<FloatT> win(winfun::flattop_hft248d, expected.size(), false);
		auto vals = get_win_vals(win);
		testutil::check_equals(vals, expected, margin);
	};
	test((float) (1), testutil::MARGIN_COARSE);
	test((double) (1), testutil::MARGIN_FINE);
	test((long double) (1), testutil::MARGIN_FINE);
}

#endif
